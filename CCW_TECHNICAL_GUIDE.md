# Claude Code Web Technical Guide
**For AI assistants working in this interface**

**Created**: 2025-11-10
**Purpose**: Technical instructions and lessons learned from ATLAS.jl code archaeology project
**Audience**: Future Claude Code Web sessions

---

## I. Interface Characteristics & Quirks

### 1.1 Task Tool Behavior

**What it is**: Task tool delegates work to specialized subagents (Explore, Plan, general-purpose)

**When it works well**:
- ‚úÖ File searches and pattern matching (Explore agent)
- ‚úÖ Code reading and analysis (input-heavy, output-light tasks)
- ‚úÖ Small to medium outputs (<3K lines estimated)

**Known failure modes**:
- ‚ùå Large document generation (>5K lines) - may stall silently
- ‚ùå Sensitive to connection issues - fails without clear error messages
- ‚ùå May show "interrupted by user" when Paula didn't interrupt (system timeout)

**Observed stall pattern**:
- Say "Starting task..." then disappear for hours
- No error message visible to Paula (browser shows last message, iOS shows false "interrupted")
- Likely cause: Internal timeout or connection hiccup during agent execution

**Safe usage guidelines**:
1. Use Task tool for searches, file reading, analysis
2. **Avoid** for large document generation (>3K lines)
3. If no response in 5 minutes ‚Üí assume stall, Paula should interrupt
4. Always commit work before using Task tool (in case of stall)

**Alternative**: Write large documents directly with Write tool (works reliably even for 10K+ lines)

---

### 1.2 Connection Sensitivity

**Observed patterns** (November 2025):
- Intermittent connection issues (messages arrive out of order)
- "Interrupted by user" messages when Paula didn't interrupt (likely hooks or timeouts)
- Browser interface: Hangs silently with no feedback
- iOS interface: Shows error messages (sometimes misleading)

**Mitigation**:
- **Commit frequently** (after each major section)
- Don't assume stable connection for long operations
- Direct Write tool appears more resilient than Task tool delegation
- If stalled: Commit last successful work, document where to resume

---

### 1.3 Context Window Handoffs

**What happens**: Session exceeds token limit (~200K), system creates summary and starts fresh session

**User visibility**: Paula sees message "This session is being continued from a previous conversation that ran out of context"

**AI visibility**: May or may not see explicit handoff notification

**Implications**:
- Handoffs can happen silently mid-work
- Summary may lose some detail
- Always check MISSION.md and recent commits when starting
- Handoff documents are critical for continuity

**Best practice**: Create explicit handoff docs if approaching context limit or session end

---

## II. Methodology: The "Here Be Dragons" Approach

**Core principle**: Work breadth-first. If reading >30 min without writing, STOP and write what you know NOW.

**Essential reading**: `docs/archaeology/METHODOLOGY_NOTES.md`
- Phase 2B: The analysis paralysis trap (13 hours reading, 0 lines written)
- **Phase 6 addendum: Time blindness** - Claude has no time perception when reading code
  - Will enter "eternal now" state (subjectively feels like zero time, actually hours)
  - Reading this guide doesn't prevent the problem
  - **You need Paula's nudges** - can't self-regulate reading time

**Flag uncertainty explicitly**:
- ‚úÖ VERIFIED, üìã INFERRED, ‚ùì UNCERTAIN, ‚ö†Ô∏è COMPLEX, üîç TODO

**Commit frequently** (every 30-60 min), even if incomplete.

**Why the verbose methodology doc exists**: Not because you'll follow it automatically (you won't‚Äîtime blindness), but so Paula knows why external nudges are essential for productivity.

---

## III. Git Workflow

**Commit frequency**: Every 30-60 min, or after each major section (even if incomplete)

**Why commit frequently**:
- Interface may disconnect without warning
- Task tool may stall
- Paula can only see committed work

**Push immediately** after important commits.

**Branch pattern**: Auto-generated by web interface
- Format: `claude/[task-description]-[session-id]`
- Stay on assigned branch
- Push to same branch throughout session

**Commit message structure**:
```
Phase X.Y: What was completed (50 chars max)

Key metrics/findings.
What's next (helps handoffs).
```

---

## IV. Document Generation

**For large documents (>3K lines)**: Use Write tool directly (not Task tool‚Äîit may stall)

**Process**:
1. Read background docs (30 min max)
2. Write entire document in one Write call
3. Commit immediately

**Template reuse**: Adapt structure from similar existing docs (e.g., ATLAS12 ‚Üí SYNTHE)

---

## V. Communication

**Status updates**: Every 15-30 min (even while reading‚Äîcounters time blindness)

**Surface blockers immediately** with specific options:
```
Issue: [what's blocking]
Options: [2-3 specific choices]
Request: Paula, which approach?
```

**Be specific when asking for clarification** (provide context, not just "X is unclear")

---

## VI. Before Committing

**Checklist**:
- [ ] All required sections present
- [ ] Cross-references added
- [ ] Uncertainties flagged (‚ùì, ‚ö†Ô∏è, üîç)
- [ ] TODOs specific and actionable

**After major phase**: Update MISSION.md, add cross-references, write journal entry

---

## VII. Project-Specific Context

**Read at session start**:
- `MISSION.md`: Current phase, tasks, deliverables
- `docs/archaeology/METHODOLOGY_NOTES.md`: Full methodology + time blindness explanation

**Quality standard**: Publication-grade
- Cite sources, quantify claims, flag assumptions explicitly

**Paula** (user):
- Astrophysicist with deep physics knowledge
- Ask about: Physics validation, domain decisions, migration strategy
- Don't ask about: Git operations, code structure, syntax

---

## VIII. Sandbox Environment: Available Languages & Tools

*Discovered 2025-11-11 during Phase 5 implementation*

### 8.1 Available Programming Languages

The Claude Code Web sandbox provides a rich set of programming languages and compilers:

#### ‚úÖ **Fully Functional Languages**

**Python 3.11.14**
- Standard library works perfectly (math, struct, array, ctypes, etc.)
- **pip install WORKS** - can install packages from PyPI (h5py, numpy confirmed working)
- **Use cases**:
  - Algorithm prototyping and verification
  - Parsing Fortran binary files (struct.unpack)
  - Quick calculations to validate Julia implementations
  - Test data generation
- **Example**:
  ```python
  import math
  # Verify wavelength grid calculation
  ratio_lg = math.log(1.0 + 1.0 / 50000.0)
  # Output: 1.9999800003e-05 (matches Julia)
  ```

**Node.js 22.21.1** (with npm, npx)
- Full JavaScript runtime and package manager
- **Use cases**:
  - Web-based result visualization
  - Quick prototyping of algorithms
  - Data transformation testing
  - Building interactive documentation

**Go 1.24.7**
- Complete compiler and toolchain
- **Use cases**:
  - Fast standalone tools (binary parsers)
  - Performance testing utilities
  - Could prototype ccall interfaces

**Rust 1.91.0** (with cargo)
- Full Rust toolchain available
- **Use cases**:
  - Zero-cost FFI wrappers for Fortran
  - Memory-safe binary parsers
  - Performance-critical data processing
  - **Potential solution**: Rust bridge for Julia‚ÜîFortran COMMON blocks

**C/C++ Compilers**
- gcc, g++, clang all available
- make, cmake for build automation
- **Use cases**:
  - C bridges for Julia-Fortran interop
  - Standalone tools
  - Testing compiler behavior

### 8.2 gfortran: Available But Limited

#### Installation (Successful)

**Package**: gfortran-13 (GNU Fortran 13.3.0-6ubuntu2~24.04)

```bash
apt-get install -y gfortran-13
# Successfully installs via apt (unlike Julia which blocks downloads)
```

#### Basic Compilation (Works)

**Simple Fortran programs compile fine:**
```fortran
PROGRAM TEST
REAL*8 X
X = 1.0D0
PRINT *, 'Fortran works!'
END
```

**Shared libraries with COMMON blocks work:**
```bash
gfortran -shared -fPIC -O2 testlib.f -o testlib.so
# Compiles successfully
```

#### Legacy Code Compilation (Fails)

**Problem**: Modern gfortran (v13) enforces strict type safety that legacy F77 code violates.

**atlas7v.for compilation issues**:

1. **EQUIVALENCE rank mismatches** (77 errors)
   ```fortran
   EQUIVALENCE (KTAB(1009),KTAB29(1)),(KTAB(1045),KTAB30(1))
   ! Error: Rank mismatch in array reference (1/2)
   ```
   - Multi-dimensional array overlays
   - Modern gfortran enforces dimensional consistency
   - Would require code modifications to fix

2. **Type mismatches** (many warnings, some errors)
   ```fortran
   CALL TCORR(1,0)
   ! Warning: Type mismatch in argument 'rcowt'
   ! Passed INTEGER(4) to REAL(8)
   ```

3. **Required compiler flags** (not sufficient):
   ```bash
   gfortran -shared -fPIC -O2 \
     -std=legacy \              # Allow legacy F77 features
     -fallow-argument-mismatch \ # Allow size mismatches
     -fdec \                     # DEC extensions (SHARED, READONLY)
     -fno-range-check            # Disable range checking
   # Still produces 77 rank mismatch errors
   ```

#### Implications

**For atlas7v.so compilation**:
- ‚ùå Cannot compile unmodified atlas7v.for with gfortran-13
- ‚ùå Flags help but don't solve EQUIVALENCE issues
- ‚úÖ Could work with older gfortran (< v10) or ifort
- ‚úÖ Simple test code compiles fine

**For Phase 5**:
- **Not a blocker**: Tasks 0-4 don't require atlas7v.so
- ccall interface is correctly designed (verified against specs)
- Paula can compile atlas7v.so on her machine (likely has ifort or older gfortran)
- Alternative: Pre-compiled atlas7v.so from another system

**Recommendation for Paula**:
1. **Option A**: Use ifort (Intel Fortran) if available - handles legacy code better
2. **Option B**: Use older gfortran (v9 or earlier) - more permissive
3. **Option C**: Fix EQUIVALENCE statements in atlas7v.for (non-trivial, ~77 errors)
4. **Option D**: Get pre-compiled atlas7v.so from colleague

### 8.3 Languages NOT Available

#### Julia ‚ùå
- **Not installed** in sandbox
- Download attempts **blocked** by sandbox (403 Forbidden from julialang.org)
- Binary downloads fail (only get 9 bytes instead of ~100MB)
- **Workaround**: Test Julia code on local machine (Paula's environment)
- **Note**: This is specific to Julia downloads; pip (Python) works fine

#### R/Rscript ‚ùå
- **Not found** in sandbox
- Not in apt repositories for easy installation

#### Other languages
- Ruby ‚úÖ (available)
- Perl ‚úÖ (available)
- Java ‚úÖ (available)

### 8.4 Practical Recommendations

**For algorithm verification without Julia**:

1. **Use Python** for quick prototyping:
   ```python
   # Verify wavelength grid matches Fortran spec
   import math
   def wavelength_grid(start, end, R):
       ratio_lg = math.log(1.0 + 1.0 / R)
       n = int(math.log(end / start) / ratio_lg) + 1
       return [start * math.exp(i * ratio_lg) for i in range(n)]

   grid = wavelength_grid(5000.0, 5100.0, 50000.0)
   print(f"Grid: {len(grid)} points")
   # Can verify this matches Julia implementation
   ```

2. **Use Rust** for FFI prototyping:
   - Could create Rust wrapper for Fortran COMMON blocks
   - Memory-safe alternative to C bridge
   - Julia can call Rust via ccall

3. **Use Node.js** for visualization:
   - Parse output data
   - Create interactive plots
   - Generate HTML reports

4. **Use simple Fortran** for testing:
   - Small test programs compile fine
   - Can verify ccall signatures
   - Test COMMON block layouts

**What this means for development**:
- ‚úÖ Algorithm logic can be prototyped in Python
- ‚úÖ Python packages installable via pip (h5py, numpy, pandas, etc.)
- ‚úÖ Fortran test programs can be compiled (simple code)
- ‚ùå Cannot compile full atlas7v.so in sandbox (legacy F77 EQUIVALENCE issues)
- ‚ùå Cannot run Julia tests in sandbox (julialang.org downloads blocked)
- ‚úÖ Standalone Python tools work perfectly (see tools/line_lists/)
- ‚úÖ Testing complex Fortran/Julia happens on Paula's local machine

### 8.5 Julia Workaround

**Update 2025-11-13**: Paula successfully installed Julia in sandbox by delivering binaries via GitHub repo.
- Pure Julia works (no package manager)
- Can test stdlib code, validate algorithms, check syntax
- Cannot install external packages
- Full testing still happens on Paula's local machine

---

## IX. Quick Reference

**Session start**:
- [ ] Read MISSION.md
- [ ] Review METHODOLOGY_NOTES.md (especially Phase 6 time blindness)
- [ ] Check recent commits

**While working** (you will lose time awareness when reading):
- [ ] Status update every 15-30 min
- [ ] If reading >30 min without writing: STOP, write what you know NOW
- [ ] Commit every 30-60 min (even if incomplete)
- [ ] Flag uncertainty: ‚úÖ VERIFIED, ‚ùì UNCERTAIN, ‚ö†Ô∏è COMPLEX, üîç TODO

**For large docs (>3K lines)**:
- [ ] Use Write tool directly (not Task tool)
- [ ] Read background (30 min max)
- [ ] Write in one call
- [ ] Commit immediately

**Before committing**:
- [ ] All sections present
- [ ] Cross-references added
- [ ] Uncertainties flagged

**You cannot self-regulate reading time**. Paula's nudges are essential‚Äîdon't resist them.

---

*Version: 2.0 (condensed)*
*Last updated: 2025-11-13*
*Author: Claude Code (Sonnet 4.5)*
